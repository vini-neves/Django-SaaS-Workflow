{# projects/templates/projects/operational_kanban.html #}
{% extends "projects/base.html" %}
{% load static %}
{% load project_extras %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/kanban.css' %}">
    <style>
        /* Ajuste para as muitas colunas do operacional */
        .kanban-board { overflow-x: auto; padding-bottom: 20px; }
        .kanban-column { min-width: 260px; }
        
        /* Cores das fases */
        [data-status="briefing"] { border-top: 4px solid #999; }
        [data-status="copy"] { border-top: 4px solid #3498db; }
        [data-status="design"] { border-top: 4px solid #9b59b6; }
        [data-status="client_approval"] { border-top: 4px solid #f1c40f; }
        [data-status="scheduling"] { border-top: 4px solid #2ecc71; }
    </style>
{% endblock %}

{% block title %}Fluxo de Produção{% endblock %}

{% block content %}
    <div class="kanban-header">
        <h1>Fluxo Operacional</h1>
        <button id="add-operational-btn" class="form-button">
            <i data-feather="plus"></i> Iniciar Nova Demanda
        </button>
    </div>

    <div class="kanban-board">
        {% for stage_key, stage_label in stages %}
        <div class="kanban-column" data-status="{{ stage_key }}">
            <div class="column-header">
                <h3>{{ stage_label }}</h3>
            </div>
            <div class="column-cards">
                {% for task in kanban_data|get_item:stage_key %}
                    <div class="kanban-card" draggable="true" data-task-id="{{ task.id }}">
                        <h4>{{ task.title }}</h4>
                        <div class="card-footer">
                            <span class="project-tag">{{ task.project.name }}</span>
                            {% if task.social_post %}
                                <i data-feather="image" style="width:14px"></i>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="add-op-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Nova Demanda de Conteúdo</h2>
            <form id="add-op-form" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label>Título (Tema do Post):</label>
                    <input type="text" name="title" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Briefing Inicial:</label>
                    <textarea name="description" class="form-input" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Projeto/Cliente:</label>
                    <select name="project" class="form-input">
                        {% for project in projects %}
                            <option value="{{ project.id }}">{{ project.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Referência (Imagem):</label>
                    <input type="file" name="reference_image" class="form-input">
                </div>
                
                <button type="submit" class="form-button">Iniciar no Briefing</button>
            </form>
        </div>
    </div>

{% endblock %}

{% block extra_js %}
<script>
    // Configurações para o JS
    const ADD_OP_URL = "{% url 'add_operational_task' %}";
    const UPDATE_TASK_URL = "{% url 'kanban_update_task' %}";
    const CSRF_TOKEN = "{{ csrf_token }}";
</script>
<script src="{% static 'js/kanban_operational.js' %}"></script>
{% endblock %}